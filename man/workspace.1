.TH workspace 1 "February 2025" "workspace 1.0" "User Commands"
.SH NAME
workspace \- manage terminal sessions and git worktrees
.SH SYNOPSIS
.B workspace
.B open
.RI [ path ]
.br
.B workspace
.B close
.RI [ session_name ]
.br
.B workspace
.B remove
.RI [ branch_name ]
.br
.B workspace
.B worktree
.B create
.RB [ \-\-setup ]
.I branch_name
.br
.B workspace
.B worktree
.B remove
.RI [ branch_name ]
.br
.B workspace
.B worktree
.B prune
.RB [ \-\-force ]
.br
.B workspace
.B help
.br
.B workspace
.B \-\-version
.SH DESCRIPTION
.B workspace
is a unified tool for managing terminal sessions and git worktrees. It auto-detects the terminal environment and operates in one of three modes:
.B tmux mode
(inside a tmux session),
.B ghostty mode
(running in Ghostty terminal without tmux), or
.B unsupported
(neither detected).
.PP
The tool provides two operational modes:
.B sessionizer mode
for quick directory-based sessions, and
.B worktree mode
for full git worktree management.
.PP
In sessionizer mode (default), the tool helps you quickly open existing directories in terminal sessions. It uses fzf to find git projects (both regular repositories and worktrees) in your current directory tree.
.PP
In worktree mode (via the
.B worktree
subcommand), the tool provides full git worktree capabilities: creating new worktrees for branches, managing their lifecycle, and automatically setting up terminal sessions. When creating a worktree, the tool creates a git worktree in a sibling directory, sets up a session with a configurable layout (tmux only), copies environment and certificate files from the parent worktree, and optionally runs setup commands.
.SH TERMINAL DETECTION
The tool automatically detects the terminal environment at startup:
.TP
.B tmux mode
Active when the
.B TMUX
environment variable is set (running inside a tmux session). Provides full functionality including pane layouts, environment variable forwarding, and send-keys support.
.TP
.B ghostty mode
Active when
.B TERM_PROGRAM
is set to "ghostty" and not inside tmux. Uses Ghostty tabs instead of tmux sessions. On macOS, new tabs are opened via
.BR "open -a Ghostty" ;
on Linux, via the
.B ghostty
CLI. This mode has reduced functionality:
.RS
.IP \(bu 2
No pane layout support (WORKSPACE_INTERNAL_LAYOUT is ignored)
.IP \(bu 2
No environment variable forwarding (worktree_* variables are not set in tabs)
.IP \(bu 2
No programmatic tab queries (prune cannot detect active tabs)
.IP \(bu 2
No send-keys support (\-\-setup prints the command instead of executing it)
.IP \(bu 2
Tabs cannot be closed programmatically (user must close manually)
.RE
.TP
.B unsupported
When neither tmux nor Ghostty is detected, terminal-dependent commands (open, close) will fail with an error. Git-only commands (worktree remove, worktree prune) still work.
.PP
If tmux is running inside Ghostty, tmux mode takes priority.
.SH MODES
.TP
.B Sessionizer Mode (Default)
Without the
.B worktree
subcommand, the tool operates as a terminal session manager. The
.B open
command finds existing git projects using fzf and creates sessions for them. This mode is ideal for:
.RS
.IP \(bu 2
Quick navigation between projects
.IP \(bu 2
Opening existing worktrees
.IP \(bu 2
Working with any git repository
.IP \(bu 2
Simple tmux session management
.RE
.TP
.B Worktree Mode
With the
.B worktree
subcommand, the tool provides full git worktree lifecycle management. Additional commands (create, remove, prune) become available for managing git worktrees. This mode is ideal for:
.RS
.IP \(bu 2
Feature branch development
.IP \(bu 2
Working on multiple branches simultaneously
.IP \(bu 2
Automated worktree setup with custom layouts
.IP \(bu 2
Managing worktree lifecycle (creation, pruning)
.RE
.SH COMMANDS
.SS Common Commands (Both Modes)
.TP
.BI "open " [path]
Open an existing directory in a terminal session (tmux session or Ghostty tab). If no path is provided, the behavior depends on context:
.RS
.IP \(bu 2
.B Inside a git worktree:
Uses fzf to list all existing worktree branches and remote branches. On selection, creates or switches to the worktree session (equivalent to
.BR "worktree create" ).
.IP \(bu 2
.B Otherwise:
Uses fzf to interactively select from git projects (repositories and worktrees) found up to 3 levels deep from the current directory.
.RE
.IP
In tmux mode, if a session for the directory already exists, attaches to it (or switches to it if already inside tmux). Otherwise, creates a new session with the configured layout. In Ghostty mode, always opens a new tab (existing tabs cannot be queried).
.IP
Session names are derived from the directory path. If the target is within the current directory, the relative path is used; otherwise, the basename is used. Dots and slashes are replaced with underscores for tmux compatibility.
.TP
.BI "close " [session_name]
Close the specified session. In tmux mode, kills the tmux session. In Ghostty mode, prints a message to close the tab manually. If
.I session_name
is omitted, auto-detects from the current environment. An error is returned if no terminal backend is detected.
.TP
.BI "remove " [branch_name]
Close the session and remove the git worktree for the specified branch. If
.I branch_name
is omitted, uses the current branch. Protected branches (main, master, _main, _master) cannot be removed. Any processes holding files in the worktree directory are automatically terminated.
.IP
This is a convenience shorthand for closing the session and removing the worktree in one step, without requiring the
.B worktree
subcommand.
.TP
.B help
Display usage information and exit. Also accepts
.B \-\-help
and
.BR \-h .
.TP
.B \-\-version
Print the version number and exit. Also accepts
.BR \-v .
.SS Worktree Subcommands (workspace worktree <subcommand>)
.TP
.BI "create " "[--setup] branch_name"
Create a new git worktree for the specified branch and open a terminal session (tmux session or Ghostty tab). The worktree is created as a sibling directory to the main repository. The tool automatically:
.RS
.IP \(bu 2
Fetches latest changes from remote
.IP \(bu 2
Creates a worktree from a remote branch if it exists on origin, or creates a new local branch
.IP \(bu 2
Sets up a terminal session with the configured layout (tmux only)
.IP \(bu 2
Copies .env and .pem files from the parent repository
.IP \(bu 2
Propagates worktree_* environment variables to the session (tmux only)
.RE
.IP
If the worktree already exists, it is reused. The tool performs a smart pull with safety checks:
.RS
.IP \(bu 2
Skips pull for local-only branches (no remote tracking)
.IP \(bu 2
Skips pull if there are uncommitted changes
.IP \(bu 2
Fast-forwards if possible
.IP \(bu 2
Warns if the branch has diverged from remote
.RE
.IP
Any existing session for the branch is closed and recreated with the current layout configuration (tmux) or a new tab is opened (Ghostty).
.IP
Use the
.B \-\-setup
flag to run the command specified in
.B WORKSPACE_INTERNAL_SETUP_CMD
after creating the worktree. In tmux mode, the command is sent to the first pane. In Ghostty mode, the command is printed for manual execution.
.TP
.BI "remove " [branch_name]
Remove the git worktree for the specified branch. If
.I branch_name
is omitted, uses the current branch. Protected branches (main, master, _main, _master) cannot be removed. Any processes holding files in the worktree directory are automatically terminated.
.TP
.BI "prune " [--force]
Remove all worktrees that have no active session. In Ghostty mode, active tabs cannot be detected, so the tool relies on the clean-working-tree check as a safety net. By default, worktrees with uncommitted changes are skipped. This command preserves:
.RS
.IP \(bu 2
The main worktree
.IP \(bu 2
Protected branches (main, master, _main, _master)
.IP \(bu 2
Worktrees with active sessions (tmux only)
.IP \(bu 2
Worktrees with uncommitted changes (unless
.B \-\-force
is used)
.RE
.IP
Use the
.B \-\-force
flag to also remove worktrees that have uncommitted changes. Stray processes holding files in the worktree are killed automatically if the initial removal fails.
.SH ENVIRONMENT
.TP
.B WORKSPACE_INTERNAL_LAYOUT
Defines the tmux layout configuration for new sessions. Uses a compact format:
.IR <count><direction> , <count><direction> ,...
where
.I count
is the number of panes and
.I direction
is one of:
.RS
.IP \(bu 2
.B v
\- vertical splits (side-by-side, using even-horizontal layout)
.IP \(bu 2
.B h
\- horizontal splits (stacked, using even-vertical layout)
.IP \(bu 2
.B g
\- grid layout (equal squares, using tiled layout)
.RE
.IP
Each comma-separated segment creates a new tmux window. The first pane of the first window is selected after creation.
.IP
.B Default:
1v (single pane, single window)
.IP
.B Examples:
.RS
.IP \(bu 2
.B 2v
\- One window with 2 vertical panes (side-by-side)
.IP \(bu 2
.B 3h
\- One window with 3 horizontal panes (stacked)
.IP \(bu 2
.B 4g
\- One window with 4 panes in a 2x2 grid
.IP \(bu 2
.B 2v,3h,1v
\- Three windows: first has 2 vertical panes, second has 3 horizontal panes, third has 1 pane
.RE
.TP
.B WORKSPACE_INTERNAL_SETUP_CMD
Command to run after creating a new worktree when
.B \-\-setup
is specified. In tmux mode, the command is sent as keystrokes to the first pane. In Ghostty mode, the command is printed for manual execution. Typically used for installing dependencies or running build commands.
.IP
.B Example:
export WORKSPACE_INTERNAL_SETUP_CMD="pnpm i && pnpm build"
.TP
.B worktree_*
Any environment variable prefixed with
.B worktree_
(except those starting with
.BR worktree_INTERNAL )
will be set in the session environment with the prefix removed (tmux only). For example,
.B worktree_API_KEY
becomes
.B API_KEY
in the tmux session. In Ghostty mode, these variables are not forwarded.
.TP
.B TMUX
Set automatically by tmux. When present, the tool operates in tmux mode.
.TP
.B TERM_PROGRAM
Used to detect Ghostty terminal. When set to "ghostty" and TMUX is not set, the tool operates in Ghostty mode.
.SH FILES
.TP
.I .env
When creating a worktree, all
.B .env
files are copied from the parent worktree to the new worktree, preserving directory structure. Existing
.B .env
files in the target worktree are never overwritten.
.TP
.I *.pem
All
.B .pem
certificate files are copied from the parent worktree to the new worktree, preserving directory structure. Existing
.B .pem
files in the target worktree are never overwritten.
.SH EXAMPLES
.SS Sessionizer Mode
.TP
Open a project using fzf to select from current directory:
.B workspace open
.TP
Open a specific directory:
.B workspace open ~/projects/myapp
.TP
Close current tmux session:
.B workspace close
.TP
Kill session and remove worktree for current branch:
.B workspace remove
.TP
Kill session and remove worktree for a specific branch:
.B workspace remove feature/old-feature
.SS Worktree Mode
.TP
Create a worktree for a feature branch:
.B workspace worktree create feature/user-auth
.TP
Create worktree and run setup commands:
.B workspace worktree create \-\-setup feature/api-refactor
.TP
Open an existing worktree:
.B workspace open
.TP
Remove worktree for a specific branch:
.B workspace worktree remove feature/old-feature
.TP
Remove current branch's worktree:
.B workspace worktree remove
.TP
Clean up all unused worktrees:
.B workspace worktree prune
.TP
Force-clean all unused worktrees, including those with uncommitted changes:
.B workspace worktree prune \-\-force
.SH WORKFLOW EXAMPLES
.SS Quick Project Switching
.nf
.RS
# Navigate to your projects directory
cd ~/projects

# Use fzf to find and open any project
workspace open

# Work in the project...

# Close when done
workspace close
.RE
.fi
.SS Feature Development with Worktrees
.nf
.RS
# Configure layout and setup command
export WORKSPACE_INTERNAL_LAYOUT="2v,3h"
export WORKSPACE_INTERNAL_SETUP_CMD="pnpm install"

# Create a new worktree with auto-setup
workspace worktree create \-\-setup feature/new-api

# Work on the feature...

# Close the session (worktree remains on disk)
workspace close

# Later, reopen the worktree
workspace open

# When feature is merged, kill session and remove worktree
workspace remove feature/new-api

# Or clean up all unused worktrees at once
workspace worktree prune
.RE
.fi
.SH CONFIGURATION
Set environment variables in your shell configuration:
.PP
.nf
.RS
# Tmux layout: 2 vertical panes in first window, 4-pane grid in second
export WORKSPACE_INTERNAL_LAYOUT="2v,4g"

# Setup command for new worktrees
export WORKSPACE_INTERNAL_SETUP_CMD="pnpm install && pnpm build"

# Variables forwarded to tmux sessions (prefix removed)
export worktree_API_URL="http://localhost:3000"
export worktree_NODE_ENV="development"
.RE
.fi
.PP
.B Project Discovery:
The
.B open
command without arguments uses
.BR find (1)
to search for git projects up to 3 levels deep from the current directory. It finds both regular git repositories (directories with
.B .git
directory) and git worktrees (directories with
.B .git
file pointing to parent repository).
.SH DEPENDENCIES
.TP
.B Required:
.BR bash (1),
.BR git (1)
.TP
.B Terminal (one required):
.BR tmux (1)
(full functionality) or
Ghostty terminal (reduced functionality, see TERMINAL DETECTION)
.TP
.B Optional:
.BR fzf (1)
(interactive project selection),
.BR lsof (1)
(process cleanup during worktree removal)
.SH EXIT STATUS
.TP
.B 0
Success
.TP
.B 1
Error (missing branch name, protected branch removal, worktree not found, invalid directory, etc.)
.SH SEE ALSO
.BR git-worktree (1),
.BR tmux (1),
.BR fzf (1),
.BR fish (1),
.BR zsh (1)
.SH AUTHOR
.B @sjdonado
.UR https://github.com/sjdonado
.UE
.SH BUGS
Report bugs at:
.UR https://github.com/sjdonado/tmux-workspace/issues
.UE
